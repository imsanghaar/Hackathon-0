---
name: "task-planner"
description: "Read new .md files from AI_Employee_Vault/Inbox, analyze content, create step-by-step Plan.md in AI_Employee_Vault/Needs_Action. Integrates with vault-file-manager for moving processed files. Idempotent - processes each file once. Callable by watcher or scheduler."
---

# Task Planner Skill

## When to Use

- User says "Plan inbox files" or "Run task-planner"
- Vault watcher triggers planning workflow
- Scheduler invokes automated planning
- User wants step-by-step plans for new inbox files

## Procedure

1. **Read all .md files in AI_Employee_Vault/Inbox**
   - List all markdown files
   - Check processed tracker to skip already-processed files

2. **For each new .md file:**
   - Read and analyze the file content
   - Parse frontmatter (type, priority, created_at, related_files)
   - Identify key actions needed
   - Create step-by-step plan

3. **Create Plan.md in AI_Employee_Vault/Needs_Action:**
   - If Needs_Action folder doesn't exist, create it
   - Filename: `Plan_<original_filename>_<timestamp>.md`
   - Use structured format (see Output Format)

4. **Move processed inbox file to Done:**
   - Integrate with vault-file-manager
   - Move original file from Inbox to Done
   - Log the move action

5. **Log all actions to logs/action.log:**
   - File detection
   - Plan creation
   - File movement

## Output Format

**Plan.md Structure:**

```markdown
---
type: execution_plan
status: pending
priority: <inherited from source>
created_at: <timestamp>
source_file: <original_filename>
---

# Plan: <Original Filename>

## Source Analysis

- **File:** <original_filename>
- **Type:** <task type from frontmatter>
- **Priority:** <priority level>
- **Detected:** <timestamp>

## Step-by-Step Execution Plan

### Step 1: <First Action>
- **Action:** <what to do>
- **Details:** <how to do it>
- **Expected Output:** <result>

### Step 2: <Second Action>
- **Action:** <what to do>
- **Details:** <how to do it>
- **Expected Output:** <result>

### Step 3: <Third Action>
...

## Required Resources

- [ ] <resource 1>
- [ ] <resource 2>

## Risks & Considerations

- ⚠️ <potential issue 1>
- ℹ️ <important note>

## Completion Criteria

- [ ] All steps executed
- [ ] Output verified
- [ ] Files archived appropriately

---
*Generated by Task Planner on <timestamp>*
```

**Action Log Entry:**
```log
[2026-02-24 15:30:45] TASK_PLANNER: Analyzed <filename>
[2026-02-24 15:30:46] TASK_PLANNER: Created Plan_<filename>.md in Needs_Action
[2026-02-24 15:30:46] TASK_PLANNER: Moved <filename> to Done
```

## Important Rules

- **Idempotent:** Never process the same file twice
- **Track processed files:** Use `Logs/planner_processed.txt`
- **Create Needs_Action if missing:** Auto-create folder
- **Log everything:** All actions go to `logs/action.log`
- **Callable interface:** Can be triggered by watcher or scheduler
- **Preserve source info:** Keep reference to original file in plan

## File Paths

- **Inbox:** `AI_Employee_Vault/Inbox/`
- **Needs_Action:** `AI_Employee_Vault/Needs_Action/`
- **Done:** `AI_Employee_Vault/Done/`
- **Action Log:** `logs/action.log`
- **Processed Tracker:** `Logs/planner_processed.txt`
- **Script:** `scripts/task_planner.py`

## Running the Planner

**Direct execution:**
```bash
python scripts/task_planner.py
```

**Process specific file:**
```bash
python scripts/task_planner.py --file <filename.md>
```

**Dry run (no changes):**
```bash
python scripts/task_planner.py --dry-run
```

**Called from watcher:**
```python
from scripts.task_planner import TaskPlanner
planner = TaskPlanner()
planner.process_inbox()
```

## Integration with Vault File Manager

The planner uses vault-file-manager for file operations:

```python
# Move processed file to Done
planner.move_to_done(filename)

# This ensures consistent file management
# across all AI Employee workflows
```

## Example Plan Output

```markdown
---
type: execution_plan
status: pending
priority: high
created_at: 2026-02-24 15:30:45
source_file: client_request.md
---

# Plan: client_request.md

## Source Analysis

- **File:** client_request.md
- **Type:** client_request
- **Priority:** high
- **Detected:** 2026-02-24 15:30:00

## Step-by-Step Execution Plan

### Step 1: Review Client Request Content
- **Action:** Read and understand the client's requirements
- **Details:** Identify key deliverables and deadlines
- **Expected Output:** List of action items

### Step 2: Create Response Draft
- **Action:** Draft initial response to client
- **Details:** Address each requirement, note any questions
- **Expected Output:** Response document in Drafts/

### Step 3: Schedule Follow-up
- **Action:** Create calendar event for follow-up
- **Details:** Set reminder based on deadline
- **Expected Output:** Calendar entry created

## Required Resources

- [ ] Client contact information
- [ ] Project template documents
- [ ] Calendar access

## Risks & Considerations

- ⚠️ Deadline is tight - prioritize this task
- ℹ️ Client prefers email communication

## Completion Criteria

- [ ] All steps executed
- [ ] Output verified
- [ ] Files archived appropriately

---
*Generated by Task Planner on 2026-02-24 15:30:45*
```

## Troubleshooting

- **If Inbox is empty:** Report "No new files to process"
- **If file already processed:** Skip silently (idempotent)
- **If Needs_Action creation fails:** Log error and continue
- **If move to Done fails:** Log error, keep file in Inbox for retry
- **If plan creation fails:** Log error, do not move source file
